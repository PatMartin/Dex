<!doctype html>
<html>
<head>
  <title>Timeline</title>

<style>

<%
  println new File("javascript/vis/latest/vis.min.css").text
  println new File("javascript/jqueryui/latest/jquery-ui.min.css").text
  println new File("javascript/jqueryui/latest/jquery-ui.theme.min.css").text  
%>

.vis-item .vis-item-overflow {
  overflow: visible;
}
</style>
<script>
<%
  println new File("javascript/jquery/latest/jquery-2.1.3.min.js").text
  println new File("javascript/jqueryui/latest/jquery-ui.min.js").text
  println new File("javascript/underscore/latest/underscore-min.js").text
  println new File("javascript/d3/latest/d3.min.js").text
  println new File("javascript/dexjs/latest/dex.js").text
  println new File("javascript/vis/latest/vis.min.js").text
%>
</script>
</head>
<body>
<div id="timeline"></div>
<script type="text/javascript">

// Load dex data.  
<%
  def header = "[" + dexData.header.collect { return "\"$it\"" }.join(',') + "]"
  def data = []
  dexData.data.eachWithIndex
  {
    row, ri ->
    data << "[" + row.collect { return "\"$it\"" }.join(',') + "]"
  }
  println "var csv = { 'header' : $header,\n 'data' : [" + data.join(',\n') + "] };";
%>

  var container = document.getElementById('timeline');

  var types = dex.csv.guessTypes(csv);
  dex.console.log("TYPES", types);
  var firstDateIndex = types.indexOf("date");
  var lastDateIndex = types.lastIndexOf("date");
  var firstStringIndex = types.indexOf("string");

  var itemData = [
    {id: 1, content: 'Invalid Data, at least 1 date and 1 string required.', start: '2014-04-20'}];

  var id = 1;

  if (firstDateIndex >= 0 && firstStringIndex >= 0)
  {
    itemData = [];
    csv.data.map(function(row, ri) {
      itemData.push({
        'id' : id,
        'content' : row[firstStringIndex],
        'start' : row[firstDateIndex],
        'end' : (firstDateIndex != lastDateIndex) ? row[lastDateIndex] : undefined});
      id++;
    });
  }
  
  // Create a DataSet (allows two way data-binding)
  var items = new vis.DataSet(itemData);

  // Configuration for the Timeline
  var options = {};

  // Create a Timeline
  var timeline = new vis.Timeline(container, items, options);
</script>
</body>
</html>
